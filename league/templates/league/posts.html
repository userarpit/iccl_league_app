{% extends 'league/base.html' %}
{% load static %}

{% block content %}
<h2 class="text-3xl font-bold text-gray-700 mb-6">✍️ Posts</h2>

<div class="flex flex-col md:flex-row items-center mb-6 space-x-4">
    
    <div class="flex items-center space-x-2 mr-8 mb-4 md:mb-0">
        <label for="post-type-select" class="text-lg font-medium text-gray-700 whitespace-nowrap">Select Type:</label>
        
        <select id="post-type-select"
            class="block w-35 px-4 py-2 text-base text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            <option value="fixtures" {% if selected_post_type == 'fixtures' %}selected{% endif %}>Fixtures</option>
            <option value="results" {% if selected_post_type == 'results' %}selected{% endif %}>Results</option>
        </select>
    </div>

    <div class="flex items-center space-x-2 mr-4">
        <label for="week-date-select" class="text-lg font-medium text-gray-700 whitespace-nowrap">Select Week:</label>
        
        <select id="week-date-select"
            class="block w-65 px-4 py-2 text-base text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            {% for week_num, label in week_labels.items %}
                <option value="{{ week_num }}" {% if week_num|stringformat:"s" == selected_week_number|stringformat:"s" %}selected{% endif %}>
                    {{ label }}
                </option>
            {% endfor %}
        </select>
    </div>

    <button onclick="showPosts()"
        class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out">
        SHOW
    </button>
</div>
{% if fixtures_for_week %}
<div class="p-6 rounded-lg shadow-md text-white relative"
     style="background-image: url('{% static 'league/img/post_background.jpg' %}'); 
            background-size: cover; 
            background-position: center; 
            /* Optional overlay for better text contrast */
            background-blend-mode: darken; 
            background-color: rgba(0, 0, 0, 0.4);">

    <div class="text-center">
        <img src="{% static 'league/img/White Logo.png' %}" alt="Top Image" class="mx-auto mb-6 h-20" />

        <div class="text-2xl font-extrabold mb-6 text-white">
            MATCH DAY {{selected_week_number}} {{selected_post_type|upper}}
        </div>
        <br><br>


    {% for match in fixtures_for_week %}
        <div class="flex justify-center mb-12">
            <div class="relative w-2/3">
                <div class="w-full h-16 bg-gray-400 rounded-md flex items-center justify-between px-4">
                    <div class="flex items-center w-5/12 h-full"> 
                    
                    <img src="{{ match.home_team.logo.url }}" 
                                alt="{{ match.home_team.name }} Logo" 
                                class="h-12 w-12 object-contain flex-shrink-0">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <span class="font-bold text-sm text-black text-left ml-2 leading-tight">
                        {{ match.home_team.name }}
                    </span>
                    </div>

                    <div class="w-2/12 flex justify-center flex-shrink-0">
                        {% if selected_post_type == 'results' %}
                            <span class="text-xl font-extrabold text-blue-900">
                                {{ match.home_score }} - {{ match.away_score }}
                            </span>
                        {% else %}
                            <span class="text-xl font-extrabold text-blue-900">VS</span>
                        {% endif %}
                    </div>

                    <div class="flex items-center justify-end w-5/12 h-full"> 
                        
                        <span class="font-bold text-sm text-black text-right mr-2 leading-tight">
                            {{ match.away_team.name }}
                        </span>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <img src="{{ match.away_team.logo.url }}" 
                                alt="{{ match.away_team.name }} Logo" 
                                class="h-12 w-12 object-contain flex-shrink-0">
                    </div>
                </div>


                <div class="absolute -top-10 left-0 w-full h-10 bg-blue-800"
                    style="clip-path: polygon(0% 100%, 100% 100%, 90% 0%, 10% 0%);">
                </div>

                <div class="absolute top-16 left-0 w-full h-10 bg-blue-800"
                    style="clip-path: polygon(0% 0%, 100% 0%, 90% 100%, 10% 100%);">
                </div>
            </div>
        </div>
        <br><br><br>
    {% endfor %}

    </div>
</div>
{% else %}
    <div class="flex justify-center my-12">
        <span class="text-2xl font-bold text-gray-500">No results available for this week yet.</span>
    </div>
{% endif %}

<script>
    /**
     * Executes when the "SHOW" button is clicked.
     * Constructs a new URL with the selected type and week number as query parameters (GET request)
     * and navigates to it, forcing Django's posts_view to re-render with the new data.
     */
    function showPosts() {
        // Get current values from dropdowns
        const postType = document.getElementById('post-type-select').value;
        const weekNumber = document.getElementById('week-date-select').value;
        
        const baseUrl = window.location.pathname;
        const urlParams = new URLSearchParams(window.location.search);

        let newUrl = `${baseUrl}?type=${postType}`;

        // Add the selected week_number
        if (weekNumber) {
             newUrl += `&week_number=${weekNumber}`;
        }
        
        // Preserve the tournament ID if it exists in the current URL
        if (urlParams.has('tournament')) {
            newUrl += `&tournament=${urlParams.get('tournament')}`;
        }

        // Navigate to the new URL
        window.location.href = newUrl;
    }
</script>

{% endblock %}